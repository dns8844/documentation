[[rpicam-apps-options-reference]]
== `rpicam-apps` 选项参考

[[common-options]]
=== 常用选项

除非另有说明，否则以下选项适用于所有具有相似或相同语义学的 `rpicam-apps` 。

要将以下选项之一传递给应用程序，请在选项名称前加上 `--` .如果选项需要值，请在选项名称后立即传递该值，并用单个空格分隔。如果值包含空格，请将值用引号括起来。

一些选项有速记别名，例如 `-h` 而不是 `--help` 。使用这些速记别名而不是完整的选项名称可以节省空间和时间，但会降低易读性。

[[help]]
==== `help` 

别名： `-h` 

打印完整的选项集，以及每个选项的简要概要。不接受值。

[[version]]
==== `version` 

打印 `libcam` 和 `rpicam-apps` 的版本字符串。不接受值。

示例输出：

----
rpicam-apps build: ca559f46a97a 27-09-2021 (14:10:24)
libcamera build: v0.0.0+3058-c29143f7
----

[[list-cameras]]
==== `list-cameras` 

列出连接到Raspberry Pi的检测到的相机及其可用的传感器模式。不接受值。

传感器模式标识符具有以下形式： `S<Bayer order><Bit-depth>_<Optional packing> : <Resolution list>` 

裁剪在本机传感器像素中（即使在像素合并模式下）指定为 `(<x>, <y>)/<Width>×<Height>` . `(x, y)` 指定传感器阵列中大小为 `width x height` 的裁剪窗口的位置。

例如，以下输出显示有关索引0的 `IMX219` 传感器和索引1的 `IMX477` 传感器的信息：

----
Available cameras
-----------------
0 : imx219 [3280x2464] (/base/soc/i2c0mux/i2c@1/imx219@10)
    Modes: 'SRGGB10_CSI2P' : 640x480 [206.65 fps - (1000, 752)/1280x960 crop]
                             1640x1232 [41.85 fps - (0, 0)/3280x2464 crop]
                             1920x1080 [47.57 fps - (680, 692)/1920x1080 crop]
                             3280x2464 [21.19 fps - (0, 0)/3280x2464 crop]
           'SRGGB8' : 640x480 [206.65 fps - (1000, 752)/1280x960 crop]
                      1640x1232 [41.85 fps - (0, 0)/3280x2464 crop]
                      1920x1080 [47.57 fps - (680, 692)/1920x1080 crop]
                      3280x2464 [21.19 fps - (0, 0)/3280x2464 crop]
1 : imx477 [4056x3040] (/base/soc/i2c0mux/i2c@1/imx477@1a)
    Modes: 'SRGGB10_CSI2P' : 1332x990 [120.05 fps - (696, 528)/2664x1980 crop]
           'SRGGB12_CSI2P' : 2028x1080 [50.03 fps - (0, 440)/4056x2160 crop]
                             2028x1520 [40.01 fps - (0, 0)/4056x3040 crop]
                             4056x3040 [10.00 fps - (0, 0)/4056x3040 crop]
----


对于上面示例中的IMX219传感器：

* 所有模式都有 `RGGB` Bayer排序
* 所有模式均可在所列分辨率下提供 8 位或 10 位 CSI2 封装读数

[[camera]]
==== `camera` 

选择要使用的相机。从 xref:camera_software.adoc#list-cameras[可用相机列表]。

[[config]]
==== `config` 

别名： `-c` 

指定一个包含CLI选项和值的文件。考虑一个名为 `example_configuration.txt` 的文件，该文件包含以下文本，将选项和值指定为键值对，每行一个选项，仅长（非别名）选项名称：

----
timeout=99000
verbose=
----

TIP: 省略您通常在命令行上传递的前导 `--` 。对于缺少值的标志，例如上面示例中的 `verbose` ，您必须在后面添加 `=` 。

然后，您可以运行以下命令来指定99000毫秒的超时和详细输出：

[source,console]
----
$ rpicam-hello --config example_configuration.txt
----

[[timeout]]
==== `timeout` 

别名： `-t` 

默认值：5000毫秒（5秒）

指定应用程序在关闭前运行多长时间。这适用于视频录制和预览窗口。捕获静止图像时，应用程序会在捕获输出图像之前显示 `timeout` 毫秒的预览窗口。

要无限期运行应用程序，请指定值 `0` 。

[[preview]]
==== `preview` 

别名： `-p` 

设置桌面或DRM预览窗口的位置（x，y坐标）和大小（w，h尺寸）。不影响相机请求的图像的分辨率或长宽比。缩放图像大小和柱子或信箱图像长宽比以适应预览窗口。

以逗号分隔的形式传递预览窗口尺寸： `x， y，w，h` 

示例： `rpicam-hello --preview 100,100,500,500` 

image::images/preview_window.jpg[信箱预览图像]

[[fullscreen]]
==== `fullscreen` 

别名： `-f` 

强制预览窗口使用整个屏幕，没有边框或标题栏。缩放图像大小并调整图像宽高比，使其适合整个屏幕。不接受数值。

[[qt-preview]]
==== `qt-preview` 

使用Qt预览窗口，它比替代窗口消耗更多资源，但支持X窗口转发。与 xref:camera_software.adoc#fullscreen[`fullscreen`] 标志不兼容。不接受值。

[[nopreview]]
==== `nopreview` 

别名： `-n` 

使应用程序_不_显示预览窗口。不接受值。


[[info-text]]
==== `info-text` 

默认值： `"#%frame (%fps fps) exp %exp ag %ag dg %dg"` 

在桌面环境中运行时，将提供的字符串设置为预览窗口的标题。支持以下图像元数据替换：

|===
| 指令 | 替代

|  `%帧` 
| 帧的序列号。

|  `%fps` 
| 瞬时帧率。

|  `%exp` 
| 用于捕获图像的快门速度，以微秒为单位。

|  `%ag` 
| 模拟增益应用于传感器中的图像。

|  `%dg` 
| ISP应用于图像的数字增益。

|  `%rg` 
| 增益应用于每个像素的红色分量。

|  `%bg` 
| 增益应用于每个像素的蓝色分量。

|  `%焦点` 
| 图像的焦点指标，其中较大的值意味着更清晰的图像。

|  `%lp` 
| 以屈光度为单位的当前镜头位置（1/距离，以米为单位）。

|  `%afstate` 
| 自动对焦算法状态（ `idle` ， `scanning` ， `focused` 或 `failed` ）。
|===

image::images/focus.jpg[显示焦点测量的图像]

[[width-and-height]]
==== `width` 和 `height` 

每个都接受一个数字，定义捕获图像的尺寸（以像素为单位）。

对于 `rpicam-still`、 `rpicam-jpeg` 和 `rpicam-vid` ，指定输出分辨率。

对于 `rpicam-raw` ，指定原始图像的分辨率。对于采用 2×2 分档读出模式的相机，指定等于或小于分档模式的分辨率可捕获 2×2 分档的原始图像。

对于 `rpicam-hello` ，没有效果。

例子：

* `rpicam-vid -o test.h264 --width 1920 --height 1080` 捕获1080p视频。

* `rpicam-still -r -o test.jpg --width 2028 --height 1520` 捕获2028×1520分辨率的JPEG。如果与HQ相机一起使用，则使用2×2 像素合并模式，因此原始文件（ `test.dng` ）包含2028×1520原始Bayer图像。

[[viewfinder-width-and-viewfinder-height]]
==== `viewfinder-width` 和 `viewfinder-height` 

每个都接受一个数字，定义预览窗口中显示的图像的尺寸（以像素为单位）。不影响预览窗口尺寸，因为图像会调整大小以适应。不影响捕获的静止图像或视频。


==== `mode` 

允许您以下列以冒号分隔的格式指定摄像机模式： `<宽度>:<高度>:<比特深度>:<包装>`。如果所提供的值不完全匹配，系统会为传感器选择最接近的可用选项。您可以使用打包 (`P`) 或未打包 (`U`) 的打包格式。影响存储视频和照片的格式，但不影响传递到预览窗口的帧格式。

位深和封装是可选的。
位深度默认为12。
打包默认为 `P` （打包）。

有关传感器可用的位深度、分辨率和封装选项的信息，请参阅 xref:camera_software.adoc#list-cameras[`list-cameras`]。

例子：

* `4056:3040:12:P` - 4056×3040 分辨率，每像素 12 位，打包。
* `1632:1224:10` - 1632×1224 分辨率，每个像素 10 位。
* `2592:1944:10:U` - 2592×1944 分辨率，每像素 10 位，未打包。
* `3264:2448` - 3264×2448 分辨率。

[[packed-format-details]]
===== 打包格式详细信息

打包格式使用较少的像素数据存储空间。

在 Raspberry Pi 4 和更早的设备上，打包格式使用 MIPI CSI-2 标准打包像素。这意味着

* 10 位摄像头模式将 4 个像素打包成 5 个字节。前 4 个字节包含每个像素的 8 个最有效位（MSB），最后一个字节包含 4 对最小有效位（LSB）。
* 12 位摄像机模式将 2 个像素打包成 3 个字节。前 2 个字节包含每个像素的 8 个最有效位 (MSB)，最后一个字节包含两个像素的 4 个最小有效位 (LSB)。

在 Raspberry Pi 5 及更高版本的设备上_，打包格式通过视觉无损压缩方案将像素值压缩为每个像素 8 位（1 个字节）。

[[unpacked-format-details]]
===== 解压格式详细信息


解压缩格式提供的像素值更易于手动操作，但像素数据的存储空间却更大。

在所有设备上，未打包格式每个像素使用 2 个字节。

在 Raspberry Pi 4 和更早的设备上，应用程序会在 *most significant end* 应用零填充。在未打包格式中，10 位相机模式的像素值不能超过 1023。

在 Raspberry Pi 5 及更早的设备上，应用程序会在 *least significant end* 应用零填充，因此图像会使用传感器提供的像素深度的全部 16 位动态范围。

[[viewfinder-mode]]
==== `viewfinder-mode` 

与 `mode` 选项相同，但它适用于传递到预览窗口的数据。有关详细信息，请参阅 xref:camera_software.adoc#mode[ `mode` 文档]。

[[lores-width-and-lores-height]]
==== `lores-width` 和 `lores-height` 

从相机传送第二个分辨率较低的图像流，缩小到指定的尺寸。

每个都接受一个数字，定义低分辨率流的维度（以像素为单位）。

可用于预览和视频模式。不适用于静态捕获。如果您指定的长宽比与正常分辨率流不同，则会生成非方形像素。

对于 `rpicam-vid` ，禁用额外的颜色去噪处理。


与 xref:camera_software.adoc#post-processing-with-rpicam-apps[图像后处理] 结合使用时对图像分析很有用。

[[hflip]]
==== `hflip` 

水平翻转图像。不接受值。

[[vflip]]
==== `vflip` 

垂直翻转图像。不接受值。

[[rotation]]
==== `rotation` 

旋转从传感器提取的图像。仅接受值0或180。

[[roi]]
==== `roi` 

裁剪从传感器的完整字段中提取的图像。接受四个十进制值，_ranged0到1_，格式如下： `<x>，<y>，<w>， h>` 。这些值中的每一个都代表可用宽度和高度的百分比，作为0到1之间的小数。

这些值定义了以下比例：

* `<x>` ：提取图像前要跳过的X坐标
* `<y>` ：提取图像前要跳过的Y坐标
* `<w>` ：要提取的图像宽度
* `<h>` ：要提取的图像高度

默认为 `0,0,1,1` （从第一个X坐标和第一个Y坐标开始，使用100%的图像宽度，使用100%的图像高度）。

例子：

* `rpicam-hello--roi 0.25,0.25,0.5,0.5` 选择从图像中心裁剪的总像素数的一半（跳过X坐标的前25%，跳过Y坐标的前25%，使用总图像宽度的50%，使用总图像高度的50%）。
* `rpicam-hello--roi 0,0,0.25,0.25` 选择从图像左上角裁剪的总像素数的四分之一（跳过X坐标的前0%，跳过Y坐标的前0%，使用25%的图像宽度，使用25%的图像高度）。

[[hdr]]
==== `hdr` 

默认值： `off` 

以HDR模式运行相机。如果不带值传递，则假定 `auto` 。接受以下值之一：

* `off` - 禁用 HDR。
* `auto` - 在支持的设备上启用 HDR。使用传感器的内置 HDR 模式（如果可用）。如果传感器没有内置 HDR 模式，则使用可用的板载 HDR 模式。
* `single-exp` - 使用板载 HDR 模式（如果可用），即使传感器有内置 HDR 模式。如果板载 HDR 模式不可用，则禁用 HDR

Raspberry Pi 5及更高版本的设备具有板载HDR模式。

要检查传感器中的内置 HDR 模式，除了 xref:camera_software.adoc#list-cameras[`list-cameras`] 之外，还需传递此选项。

[[camera-control-options]]
=== 相机控制选项

以下选项控制影响相机画质的图像处理和算法。

[[sharpness]]
==== `sharpness` `锐化` 

设置图像清晰度。接受以下光谱的数值：

* `0.0` 不适用锐化
* 大于 `0.0` 但小于 `1.0` 的值适用于小于默认锐化量
* `1.0` 应用默认的锐化量
* 大于 `1.0` 的值应用额外的锐化

[[contrast]]
==== `contrast` `对比度` 

指定图像对比度。接受以下光谱的数值：

* `0.0` 应用最小对比度
* 大于 `0.0` 但小于 `1.0` 的值应用于小于默认对比度量
* `1.0` 应用默认对比度量
* 大于 `1.0` 的值应用额外的对比度


[[brightness]]
==== `brightness` `亮度` 

指定图像亮度，作为输出图像中所有像素的偏移量添加。接受以下光谱的数值：

* `-1.0` 适用于最小亮度（黑色）
* `0.0` 适用标准亮度
* `1.0` 适用于最大亮度（白色）

对于许多用例，更喜欢 xref:camera_software.adoc#ev[`ev`]。

[[saturation]]
==== `saturation` `饱和度` 


* `0.0` 适用于最小饱和度（灰度）
* 大于 `0.0` 但小于 `1.0` 的值适用于小于默认饱和量
* `1.0` 应用默认的饱和度量
* 大于 `1.0` 的值应用额外的饱和度

[[ev]]
==== `ev` 

指定图像的 https://en.wikipedia.org/wiki/Exposure_value[曝光值（EV）] 补偿。接受一个数值，该数值控制沿着以下光谱传递给自动曝光/增益控制（AEC/AGC）处理算法的目标值：

* `-10.0` 应用最小目标值
* `0.0` 应用标准目标值
* `10.0` 适用最大目标值

[[shutter]]
==== `shutter` `快门` 

使用快门以_microseconds_指定曝光时间。使用此选项时，增益仍然会有所不同。如果相机以帧速率运行得太快，以至于不允许指定的曝光时间（例如，帧速率为1fps，曝光时间为10000微秒），传感器将使用帧速率允许的最大曝光时间。

有关官方相机的最小和最大快门时间列表，请参阅 xref:../accessories/camera.adoc#hardware-specification[相机硬件文档]。高于最大值的值会导致未定义的行为。

[[gain]]
==== `gain` `增益` 

别名： `--analoggain` 

设置模拟和数字增益的组合。当传感器驱动器可以提供请求的增益时，仅使用模拟增益。当模拟增益达到最大值时，ISP应用数字增益。接受一个数值。

有关官方相机的模拟增益限制列表，请参阅 xref:../accessories/camera.adoc#hardware-specification[相机硬件文档]。

有时，即使没有超过模拟增益限制，数字增益也可能超过1.0。这可能发生在以下情况下：

* 任一颜色增益低于1.0，这将导致数字增益稳定在1.0/min（red_gain，blue_gain）。这使应用于任何颜色通道的总数字增益保持在1.0以上，以避免变色伪影。
* 自动曝光/增益控制（AEC/AGC）更改期间的轻微差异。

[[metering]]
==== `metering` `测光` 

默认值： `centre` 

设置自动曝光/增益控制（AEC/AGC）算法的计量模式。接受以下值：

* `中心` -中心加权计量
* `spot` -点计量
* `平均` -平均或整个帧计量
* `自定义` -相机调谐文件中定义的自定义测光模式

有关定义自定义计量模式和调整现有计量模式中的区域权重的更多信息，请参阅 https://datasheets.raspberrypi.com/camera/raspberry-pi-camera-guide.pdf[Raspberry Pi相机和lib相机的调整指南]。

[[exposure]]
==== `exposure` `曝光` 

设置曝光配置文件。更改曝光配置文件不应影响图像曝光。相反，不同模式会调整增益设置以实现相同的净结果。接受以下值：

* `运动` ：短曝光，大收益
* `normal` ：正常曝光，正常增益
* `long` ：长期敞口，收益较小

您可以使用调谐文件编辑曝光配置文件。有关详细信息，请参阅 https://datasheets.raspberrypi.com/camera/raspberry-pi-camera-guide.pdf[树莓派相机和lib相机的调整指南]。

[[awb]]
==== `awb` `白平衡` 

设置自动白平衡（AWB）模式。接受以下值：

|===
|模式名称|颜色温度范围

|  `auto` 
| 2500K 到 8000K

|  `incandescent` 
| 2500K 到 3000K

|  `tungsten` 
| 3000K 到 3500K

|  `fluorescent` 
| 4000K 到 4700K

|  `indoor` 
| 3000K 到 5000K

|  `daylight` 
| 5500K 到 6500K

|  `cloudy` 
| 7000K 到 8500K

|  `custom` 
| 在调谐文件中定义的自定义范围。
|===

这些值只是近似值：值可能会根据相机调整而有所不同。

没有模式完全禁用AWB。相反，您可以使用 xref:camera_software.adoc#awbgains[`awbgains`] 修复颜色增益。

有关AWB模式的更多信息，包括如何定义自定义模式，请参阅 https://datasheets.raspberrypi.com/camera/raspberry-pi-camera-guide.pdf[树莓派相机和lib相机的调整指南]。

[[awbgains]]
==== `awbgains` 

设置要使用的固定红色和蓝色增益值，而不是自动白平衡（AWB）算法。设置非零值以禁用AWB。接受逗号分隔的数字输入，格式如下： `<red_gain>,<blue_gain>` 

[[denoise]]
==== `denoise` `降噪` 

默认值： `auto` 

设置去噪模式。接受以下值：

* `auto` ：启用标准空间去噪。对视频使用超快的色彩去噪，对图像使用高质量的色彩去噪。在预览窗口中不启用额外的色彩去噪。

* `off` ： 禁用空间和色彩去噪

* `cdn_off` ：禁用颜色降噪。

* `cdn_fast` ：使用快速颜色降噪。

* `cdn_hq` ：使用高质量的色彩去噪。由于吞吐量降低，不适合视频/取景器。

即使是快速的色彩去噪也能降低帧率。高质量的色彩去噪_大幅地_降低帧率。

[[tuning-file]]
==== `tuning-file` `调谐文件` 

指定相机调谐文件。调谐文件允许您控制图像处理的许多方面，包括自动曝光/增益控制（AEC/AGC）、自动白平衡（AWB）、颜色阴影校正、颜色处理、去噪等。接受调谐文件路径作为输入。

有关调优文件的详细信息，请参见 xref:camera_software.adoc#tuning-files[调谐文件]。

[[autofocus-mode]]
==== `autofocus-mode` `自动对焦模式` 

默认值： `default` 

指定自动对焦模式。接受以下值：

* `default` ：将相机置于连续自动对焦模式，除非 xref:camera_software.adoc#lens-position[`lens-position` ]或 xref:camera_software.adoc#autofocus-on-capture[ `autofocus-on-capture`] 将模式改成手动
* `manual` ：根本不会移动镜头，除非手动配置 xref:camera_software.adoc#lens-position[`lens-position`]
* `auto` ：仅在相机启动时或拍摄前移动镜头进行自动对焦扫描，如果还使用了 xref:camera_software.adoc#autofocus-on-capture[`autofocus-on-capture`]
* `continuous` ：随着场景的变化自动调整镜头位置

此选项仅适用于某些相机模块。

==== `autofocus-range` `自动对焦范围` 

默认值： `normal` 

指定自动对焦范围。接受以下值：

* `normal` ：从合理接近到无穷大的焦点
* `macro` ：只关注近距离物体，包括相机支持的最近焦距
* `full` ：关注整个范围，从最接近的物体到无穷大

此选项仅适用于某些相机模块。

[[autofocus-speed]]
==== `autofocus-speed` `自动对焦速度` 

默认值： `normal` 

指定自动对焦速度。接受以下值：

* `normal` ：以正常速度改变镜头位置
* `fast` ：快速改变镜头位置

此选项仅适用于某些相机模块。

==== `autofocus-range` `自动对焦范围` 

指定传感器完整字段内的自动对焦窗口。接受四个十进制值，_范围0到1_，格式如下： `<x>,<y>,<w>,h>` 。这些值中的每一个都表示可用宽度和高度的百分比，作为0到1之间的小数。

这些值定义了以下比例：

* `<x>` ：在应用自动对焦之前要跳过的X坐标
* `<y>` ：在应用自动对焦之前要跳过的Y坐标
* `<w>` ：自动对焦区域宽度
* `<h>` ：自动对焦区域高度

默认值使用两个维度中输出图像的中间三分之一（总图像区域的1/9）。

例子：

* `rpicam-hello --autofocus-window 0.25,0.25,0.5,0.5` 选择从图像中心裁剪的总像素数的一半（跳过X坐标的前25%，跳过Y坐标的前25%，使用总图像宽度的50%，使用总图像高度的50%）。
* `rpicam-hello --autofocus-window 0,0,0.25,0.25` 选择从图像左上角裁剪的总像素数的四分之一（跳过X坐标的前0%，跳过Y坐标的前0%，使用25%的图像宽度，使用25%的图像高度）。

此选项仅适用于某些相机模块。

[[lens-position]]
==== `lens-position` `镜头位置` 

默认值： `default` 

将镜头移动到固定焦距，通常以屈光度（单位为1/_distancemetres_）给出。接受以下值光谱：

* `0.0` ：将镜头移动到 `无穷大` 位置
* 任何其他 `number` ：将镜头移动到1/ `数字` 位置。例如，值 `2.0` 将聚焦在大约0.5m
* `default` ：将镜头移动到与镜头超焦位置相对应的默认位置

镜头校准不完美，因此同一型号的不同相机模块可能会有所不同。

[[verbose]]
==== `verbose` 

别名： `-v` 

默认值： `1` 

设置详细级别。接受以下值：

* `0` ：无输出
* `1` ：正常输出
* `2` ：详细输出

[[output-file-options]]
=== 输出文件选项

[[output]]
==== `输出` 

别名： `-o` 

设置用于录制图像或视频的文件的名称。除了明文文件名外，还接受以下特殊值：

* `-` : 写入标准输出。
* `udp://` （前缀）：UDP流的网络地址。
* `tcp://` （前缀）：TCP流的网络地址。
* 在文件名中包含 `%d` 指令，以替换为每打开一个文件就递增一次的计数指令。该指令支持标准 C 格式指令修饰符。

例子：

* `rpicam-vid -t 100000 --segment 10000 -o chunk%04d.h264` 在10秒段中记录一个100秒的文件，其中每个文件都包含一个递增的四位数计数器，并用前导零填充：例如 `chunk0001.h264`、 `chunk0002.h264` 等。

* `rpicam-vid -t 0 --inline -o udp://192.168.1.13:5000` 在端口5000上使用UDP将H.264视频流式传输到网络地址192.168.1.13。

[[wrap]]
==== `wrap` `包装` 

设置 xref:camera_software.adoc#output[`输出`] `%d` 指令使用的计数器的最大值。计数器在达到此值后重置为零。接受一个数值。

[[flush]]
==== `flush` `刷新` 

帧完成写入后立即将输出文件刷新到磁盘，而不是等待系统处理它。不接受值。

[[post-process-file]]
==== `post-process-file` `处理后文件` 

指定一个 JSON 文件，用于配置成像管道应用的后处理。这适用于相机图像到达应用程序之前。其工作原理类似于传统的 `raspicam` "图像特效"。接受文件名路径作为输入。

后处理是一个大课题，需要使用 OpenCV 和 TensorFlowLite 等第三方软件来分析和处理图像。有关详细信息，请参阅 xref:camera_software.adoc#post-processing-with-rpicam-apps[后处理]。